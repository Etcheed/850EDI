<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>850 Purchase Order Mapping Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            color: #000;
            background: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            border: 2px solid #000;
        }
        
        header {
            background: #000;
            color: #fff;
            padding: 40px;
            text-align: center;
            border-bottom: 2px solid #000;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        header p {
            font-size: 1.1em;
        }
        
        nav {
            background: #fff;
            padding: 15px 40px;
            border-bottom: 2px solid #000;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        nav a {
            color: #000;
            text-decoration: none;
            padding: 8px 15px;
            border: 1px solid #000;
            background: #fff;
        }
        
        nav a:hover {
            background: #000;
            color: #fff;
        }
        
        .content {
            padding: 40px;
        }
        
        section {
            margin-bottom: 50px;
            padding: 30px;
            background: #fff;
            border: 1px solid #000;
        }
        
        h2 {
            color: #000;
            font-size: 2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #000;
            font-weight: bold;
        }
        
        h3 {
            color: #000;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        h4 {
            color: #000;
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        h5 {
            color: #000;
            font-size: 1em;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        code {
            background: #000;
            color: #fff;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background: #000;
            color: #fff;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid #000;
            font-size: 0.9em;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: #fff;
        }
        
        .example {
            background: #fff;
            border: 1px solid #000;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning {
            background: #fff;
            border: 2px solid #000;
            padding: 20px;
            margin: 20px 0;
        }
        
        .success {
            background: #fff;
            border: 1px solid #000;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info {
            background: #fff;
            border: 1px solid #000;
            padding: 20px;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border: 1px solid #000;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #000;
        }
        
        th {
            background: #000;
            color: #fff;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 8px;
            border: 1px solid #000;
            background: #fff;
            color: #000;
        }
        
        .badge-primary {
            background: #000;
            color: #fff;
        }
        
        ul, ol {
            margin-left: 25px;
            margin-top: 15px;
        }
        
        li {
            margin: 10px 0;
        }
        
        .segment-box {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #000;
        }
        
        .segment-box h4 {
            color: #000;
            margin-top: 0;
            border-bottom: 1px solid #000;
            padding-bottom: 10px;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        
        p {
            margin: 15px 0;
        }
        
        strong {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>850 PURCHASE ORDER MAPPING GUIDE</h1>
            <p>Complete reference for creating Sales Orders from EDI 850 Purchase Orders</p>
        </header>
        
        <nav>
            <a href="#overview">Overview</a>
            <a href="#structure">850 Structure</a>
            <a href="#segments">Key Segments</a>
            <a href="#item-lookup">Item Lookup</a>
            <a href="#addresses">Addresses</a>
            <a href="#dates">Dates</a>
            <a href="#pricing">Pricing</a>
            <a href="#trading-partners">Trading Partners</a>
            <a href="#patterns">Common Patterns</a>
        </nav>
        
        <div class="content">
            <!-- Overview Section -->
            <section id="overview">
                <h2>OVERVIEW</h2>
                <p>The <strong>850 Purchase Order</strong> is used by trading partners to send purchase orders electronically. Your mapping transforms these EDI 850 files into NetSuite Sales Orders.</p>
                
                <div class="info">
                    <strong>PURPOSE:</strong> Convert incoming EDI 850 Purchase Orders into NetSuite Sales Orders with proper item matching, pricing, and address information.
                </div>
                
                <h3>Key Objectives</h3>
                <ul>
                    <li>Extract PO header information (PO number, dates, references)</li>
                    <li>Map ship-to addresses (header or line level)</li>
                    <li>Match items using multi-strategy lookup (VN, UP, SK, IT, etc.)</li>
                    <li>Apply correct pricing (from PO1 or CTP segments)</li>
                    <li>Handle date qualifiers for ship dates, cancel dates, etc.</li>
                    <li>Set custom forms and user-defined fields</li>
                </ul>
            </section>
            
            <!-- 850 Structure Section -->
            <section id="structure">
                <h2>850 EDI STRUCTURE</h2>
                
                <h3>Standard Transaction Flow</h3>
                <pre><code>ISA (Interchange Header)
  GS (Functional Group)
    ST*850*0001 (Transaction Set Header)
      BEG (Beginning Segment - PO Header)
      CUR (Currency - Optional)
      REF (Reference Information - Optional)
      DTM (Date/Time Reference - Optional)
      N1*ST (Ship To Address - Header Level)
        N3 (Address)
        N4 (City/State/Zip)
      PO1_loop (Line Items)
        PO1 (Baseline Item Data)
        CTP (Pricing Information - Optional)
        PID (Product Description - Optional)
        N1*ST (Ship To - Line Level - Optional)
        DTM (Line Level Dates - Optional)
      CTT (Transaction Totals)
    SE (Transaction Set Trailer)
  GE (Functional Group Trailer)
IEA (Interchange Trailer)</code></pre>
                
                <div class="two-column">
                    <div>
                        <h4>Header Level Data</h4>
                        <ul>
                            <li>PO Number (BEG03)</li>
                            <li>PO Date (BEG05)</li>
                            <li>Release Number (BEG04)</li>
                            <li>Ship To Address (N1*ST)</li>
                            <li>Currency (CUR)</li>
                            <li>Reference Info (REF)</li>
                            <li>Dates (DTM)</li>
                        </ul>
                    </div>
                    <div>
                        <h4>Line Level Data</h4>
                        <ul>
                            <li>Item Identifiers (PO1)</li>
                            <li>Quantity (PO1)</li>
                            <li>Unit Price (PO1 or CTP)</li>
                            <li>Unit of Measure (PO1)</li>
                            <li>Item Description (PID)</li>
                            <li>Line Level Ship To (N1*ST)</li>
                            <li>Line Level Dates (DTM)</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- Key Segments Section -->
            <section id="segments">
                <h2>KEY SEGMENTS & MAPPINGS</h2>
                
                <!-- BEG Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">BEG</span> Beginning Segment for Purchase Order</h4>
                    <p><strong>Purpose:</strong> Contains PO header information</p>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Description</th>
                            <th>JSONata Mapping</th>
                            <th>NetSuite Field</th>
                        </tr>
                        <tr>
                            <td><code>purchaseOrderNumber</code></td>
                            <td>PO Number</td>
                            <td><code>$beg.purchaseOrderNumber</code></td>
                            <td>Other Ref Num</td>
                        </tr>
                        <tr>
                            <td><code>date</code></td>
                            <td>PO Date (CCYYMMDD)</td>
                            <td><code>$beg.date</code></td>
                            <td>Transaction Date</td>
                        </tr>
                        <tr>
                            <td><code>releaseNumber</code></td>
                            <td>Release Number</td>
                            <td><code>$beg.releaseNumber</code></td>
                            <td>Message Block</td>
                        </tr>
                        <tr>
                            <td><code>transactionSetPurposeCode</code></td>
                            <td>00=Original, 01=Cancel</td>
                            <td><code>$beg.transactionSetPurposeCode</code></td>
                            <td>N/A</td>
                        </tr>
                    </table>
                    <div class="example">
                        <strong>Example:</strong>
                        <pre><code>$txnSet := message.transactionSets[0];
$beg := $txnSet.beginningSegmentForPurchaseOrder[0];
$poNumber := $beg.purchaseOrderNumber;
$poDate := $beg.date;
$releaseNumber := $beg.releaseNumber;</code></pre>
                    </div>
                </div>
                
                <!-- PO1 Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">PO1</span> Baseline Item Data</h4>
                    <p><strong>Purpose:</strong> Line item details (quantity, price, identifiers)</p>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Description</th>
                            <th>JSONata Mapping</th>
                            <th>NetSuite Field</th>
                        </tr>
                        <tr>
                            <td><code>assignedIdentification</code></td>
                            <td>Line Number</td>
                            <td><code>$line.assignedIdentification</code></td>
                            <td>Line Number</td>
                        </tr>
                        <tr>
                            <td><code>quantityOrdered</code></td>
                            <td>Quantity</td>
                            <td><code>$line.quantityOrdered</code></td>
                            <td>Quantity</td>
                        </tr>
                        <tr>
                            <td><code>unitOrBasisForMeasurementCode</code></td>
                            <td>Unit (EA, CS, etc.)</td>
                            <td><code>$line.unitOrBasisForMeasurementCode</code></td>
                            <td>Unit</td>
                        </tr>
                        <tr>
                            <td><code>unitPrice</code></td>
                            <td>Unit Price</td>
                            <td><code>$line.unitPrice</code></td>
                            <td>Rate</td>
                        </tr>
                        <tr>
                            <td><code>productServiceID</code></td>
                            <td>Item ID (varies by qualifier)</td>
                            <td><code>$line.productServiceID</code></td>
                            <td>Item Lookup</td>
                        </tr>
                        <tr>
                            <td><code>productServiceIDQualifier</code></td>
                            <td>VN, UP, SK, IT, etc.</td>
                            <td><code>$line.productServiceIDQualifier</code></td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td><code>productServiceID1</code></td>
                            <td>Secondary ID</td>
                            <td><code>$line.productServiceID1</code></td>
                            <td>Item Lookup</td>
                        </tr>
                        <tr>
                            <td><code>productServiceIDQualifier1</code></td>
                            <td>Secondary Qualifier</td>
                            <td><code>$line.productServiceIDQualifier1</code></td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td><code>productServiceID3</code></td>
                            <td>UPC Code</td>
                            <td><code>$line.productServiceID3</code></td>
                            <td>UPC Code</td>
                        </tr>
                    </table>
                    <div class="warning">
                        <strong>IMPORTANT:</strong> PO1 can have multiple productServiceID fields (productServiceID, productServiceID1, productServiceID2, productServiceID3) with different qualifiers. Check all of them for item lookup.
                    </div>
                </div>
                
                <!-- CTP Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">CTP</span> Pricing Information</h4>
                    <p><strong>Purpose:</strong> Additional pricing details (retail price, MSRP, etc.)</p>
                    <table>
                        <tr>
                            <th>Field</th>
                            <th>Description</th>
                            <th>JSONata Mapping</th>
                        </tr>
                        <tr>
                            <td><code>unitPrice</code></td>
                            <td>Retail/List Price</td>
                            <td><code>$ctp.pricingInformation[0].unitPrice</code></td>
                        </tr>
                        <tr>
                            <td><code>priceQualifier</code></td>
                            <td>Price Type Code</td>
                            <td><code>$ctp.pricingInformation[0].priceQualifier</code></td>
                        </tr>
                    </table>
                    <div class="example">
                        <strong>Example - Use CTP if available, fallback to PO1:</strong>
                        <pre><code>$retailPrice := $po1.CTP_loop[0].pricingInformation[0].unitPrice 
  ? $po1.CTP_loop[0].pricingInformation[0].unitPrice 
  : $line.unitPrice;</code></pre>
                    </div>
                </div>
                
                <!-- N1 Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">N1</span> Name/Address</h4>
                    <p><strong>Purpose:</strong> Ship-to, bill-to, or remit-to addresses</p>
                    <table>
                        <tr>
                            <th>Qualifier</th>
                            <th>Description</th>
                            <th>Location</th>
                        </tr>
                        <tr>
                            <td><code>ST</code></td>
                            <td>Ship To</td>
                            <td>Header or Line Level</td>
                        </tr>
                        <tr>
                            <td><code>BT</code></td>
                            <td>Bill To</td>
                            <td>Header Level</td>
                        </tr>
                        <tr>
                            <td><code>RI</code></td>
                            <td>Remit To</td>
                            <td>Header Level</td>
                        </tr>
                    </table>
                    <div class="info">
                        <strong>ADDRESS LOCATION:</strong> Some TPs send ship-to at header level (N1*ST after BEG), others send at line level (N1*ST within PO1_loop). Check your TP's structure!
                    </div>
                </div>
                
                <!-- DTM Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">DTM</span> Date/Time Reference</h4>
                    <p><strong>Purpose:</strong> Various dates with qualifiers</p>
                    <table>
                        <tr>
                            <th>Qualifier</th>
                            <th>Description</th>
                            <th>NetSuite Field</th>
                        </tr>
                        <tr>
                            <td><code>002</code></td>
                            <td>Requested Delivery Date</td>
                            <td>requestedShipDate</td>
                        </tr>
                        <tr>
                            <td><code>010</code></td>
                            <td>Requested Ship Date</td>
                            <td>requestedShipDate</td>
                        </tr>
                        <tr>
                            <td><code>001</code></td>
                            <td>Cancel Date</td>
                            <td>cancel / mustShipBy</td>
                        </tr>
                        <tr>
                            <td><code>006</code></td>
                            <td>Requested Ship Date (QVC)</td>
                            <td>requestedShipDate</td>
                        </tr>
                        <tr>
                            <td><code>069</code></td>
                            <td>Cancel Date (QVC)</td>
                            <td>mustShipBy</td>
                        </tr>
                        <tr>
                            <td><code>038</code></td>
                            <td>Delivery Date</td>
                            <td>custbody_deldate</td>
                        </tr>
                        <tr>
                            <td><code>371</code></td>
                            <td>Cancel Date (Colony)</td>
                            <td>custbody_cncldate</td>
                        </tr>
                    </table>
                </div>
                
                <!-- REF Segment -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">REF</span> Reference Information</h4>
                    <p><strong>Purpose:</strong> Additional reference numbers</p>
                    <table>
                        <tr>
                            <th>Qualifier</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td><code>IT</code></td>
                            <td>Internal Number</td>
                            <td>HSN Reference</td>
                        </tr>
                        <tr>
                            <td><code>PO</code></td>
                            <td>Purchase Order Number</td>
                            <td>Duplicate PO reference</td>
                        </tr>
                        <tr>
                            <td><code>VN</code></td>
                            <td>Vendor Number</td>
                            <td>Vendor reference</td>
                        </tr>
                    </table>
                </div>
            </section>
            
            <!-- Item Lookup Section -->
            <section id="item-lookup">
                <h2>MULTI-STRATEGY ITEM LOOKUP</h2>
                
                <p>Different trading partners send item identifiers in different formats. Use a <strong>multi-strategy fallback approach</strong> to find items in NetSuite.</p>
                
                <h3>Common Qualifiers</h3>
                <table>
                    <tr>
                        <th>Qualifier</th>
                        <th>Full Name</th>
                        <th>NetSuite Lookup</th>
                        <th>Field</th>
                    </tr>
                    <tr>
                        <td><code>VN</code></td>
                        <td>Vendor Number / Vendor SKU</td>
                        <td><code>$lookupItems(value, "itemid")</code></td>
                        <td>Item Name/Number</td>
                    </tr>
                    <tr>
                        <td><code>UP</code></td>
                        <td>UPC Code</td>
                        <td><code>$lookupItems(value, "upccode")</code></td>
                        <td>UPC Code</td>
                    </tr>
                    <tr>
                        <td><code>SK</code></td>
                        <td>Buyer SKU</td>
                        <td><code>$lookupItems(value, "itemid")</code></td>
                        <td>Item Name/Number</td>
                    </tr>
                    <tr>
                        <td><code>IT</code></td>
                        <td>Internal Number</td>
                        <td><code>$lookupItems(value, "itemid")</code></td>
                        <td>Item Name/Number</td>
                    </tr>
                    <tr>
                        <td><code>VC</code></td>
                        <td>Vendor Catalog</td>
                        <td><code>$lookupItems(value, "itemid")</code></td>
                        <td>Item Name/Number</td>
                    </tr>
                    <tr>
                        <td><code>VA</code></td>
                        <td>Vendor Style</td>
                        <td><code>$lookupItems(value, "itemid")</code></td>
                        <td>Item Name/Number</td>
                    </tr>
                </table>
                
                <h3>Standard Multi-Strategy Pattern</h3>
                <div class="example">
                    <strong>Pattern: VN → UP → SK</strong>
                    <pre><code>/* Strategy 1: Try VN (Vendor Number) */
$vnValue := $line.productServiceIDQualifier = "VN" 
  ? $line.productServiceID 
  : ($line.productServiceIDQualifier1 = "VN" 
    ? $line.productServiceID1 
    : "");
$nsItem := $vnValue 
  ? $lookupItems($vnValue, "itemid")[isinactive="F"][0] 
  : null;

/* Strategy 2: Try UP (UPC) if VN not found */
$nsItem := $nsItem ? $nsItem : (
  $upValue := $line.productServiceID3;
  $upValue ? $lookupItems($upValue, "upccode")[isinactive="F"][0] : null
);

/* Strategy 3: Try SK (Buyer SKU) if still not found */
$nsItem := $nsItem ? $nsItem : (
  $skValue := $line.productServiceIDQualifier = "SK" 
    ? $line.productServiceID 
    : ($line.productServiceIDQualifier1 = "SK" 
      ? $line.productServiceID1 
      : "");
  $skValue ? $lookupItems($skValue, "itemid")[isinactive="F"][0] : null
);

/* Unwrap nested item object */
$nsItem := $nsItem.item ? $nsItem.item : $nsItem;</code></pre>
                </div>
                
                <h3>Reusable Function Pattern</h3>
                <div class="example">
                    <strong>Create a reusable lookup function:</strong>
                    <pre><code>$findActiveItem := function($qualifier, $value) {
  $qualifier = "VN" ? $lookupItems($value, "itemid")[isinactive="F"][0] :
  $qualifier = "UP" ? $lookupItems($value, "upccode")[isinactive="F"][0] :
  $qualifier = "SK" ? $lookupItems($value, "itemid")[isinactive="F"][0] :
  $qualifier = "IT" ? $lookupItems($value, "itemid")[isinactive="F"][0] :
  undefined
};

/* Use the function */
$vnValue := $line.productServiceID1;
$nsItem := $vnValue ? $findActiveItem("VN", $vnValue) : undefined;

$nsItem := $nsItem ? $nsItem : (
  $upValue := $line.productServiceID3;
  $upValue ? $findActiveItem("UP", $upValue) : undefined
);</code></pre>
                </div>
                
                <div class="warning">
                    <strong>CRITICAL:</strong> Always filter for active items with <code>[isinactive="F"]</code> and take the first result with <code>[0]</code>.
                </div>
                
                <h3>UPC Code Stripping</h3>
                <p>Some TPs send UPC codes with leading zeros. Strip them before lookup:</p>
                <pre><code>$upcStripped := $string($upc) ~> $replace(/^0+/, "");</code></pre>
            </section>
            
            <!-- Addresses Section -->
            <section id="addresses">
                <h2>ADDRESS EXTRACTION</h2>
                
                <h3>Header Level Address (Most Common)</h3>
                <div class="example">
                    <strong>Extract from header N1*ST:</strong>
                    <pre><code>$shipTo := $txnSet.N1_loop[partyIdentification[0].entityIdentifierCode = "ST"][0];
$shipToName := $shipTo.partyIdentification[0].name ? $trim($shipTo.partyIdentification[0].name) : "";
$shipToAddr1 := $shipTo.partyLocation[0].addressInformation ? $trim($shipTo.partyLocation[0].addressInformation) : "";
$shipToCity := $shipTo.geographicLocation[0].cityName ? $trim($shipTo.geographicLocation[0].cityName) : "";
$shipToState := $shipTo.geographicLocation[0].stateOrProvinceCode ? $trim($shipTo.geographicLocation[0].stateOrProvinceCode) : "";
$shipToZip := $shipTo.geographicLocation[0].postalCode ? $trim($shipTo.geographicLocation[0].postalCode) : "";
$shipToPhone := $shipTo.geographicLocation[0].locationIdentifier ? $trim($shipTo.geographicLocation[0].locationIdentifier) : "";</code></pre>
                </div>
                
                <h3>Line Level Address (HSN Pattern)</h3>
                <div class="example">
                    <strong>Extract from first line's N1*ST:</strong>
                    <pre><code>$firstLineShipTo := $txnSet.PO1_loop[0].N1_loop[partyIdentification[0].entityIdentifierCode = "ST"][0];
$shipToName := $firstLineShipTo.partyIdentification[0].name ? $trim($firstLineShipTo.partyIdentification[0].name) : "";
$shipToAddr1 := $firstLineShipTo.partyLocation[0].addressInformation ? $trim($firstLineShipTo.partyLocation[0].addressInformation) : "";
/* ... continue with other fields ... */</code></pre>
                </div>
                
                <h3>Hardcoded Address (Von Maur Pattern)</h3>
                <div class="example">
                    <strong>Some TPs have fixed ship-to addresses:</strong>
                    <pre><code>$shipToName := "VON MAUR DISTRIBUTION CENTER";
$shipToAddr1 := "6565 BRADY STREET";
$shipToCity := "DAVENPORT";
$shipToState := "IA";
$shipToZip := "52806";
$shipToCountry := "US";</code></pre>
                </div>
                
                <h3>NetSuite Address Mapping</h3>
                <pre><code>"shippingAddress": {
  "attention": $shipToName,
  "addressee": $shipToName,
  "addr1": $shipToAddr1,
  "city": $shipToCity,
  "state": $shipToState,
  "zip": $shipToZip,
  "country": "US",
  "addrphone": $shipToPhone
}</code></pre>
            </section>
            
            <!-- Dates Section -->
            <section id="dates">
                <h2>DATE HANDLING</h2>
                
                <h3>Date Format Conversion</h3>
                <p>EDI dates come as <code>CCYYMMDD</code> strings. Use <code>$formatDate()</code> to convert to NetSuite format:</p>
                <pre><code>$poDate := $beg.date;  /* "20251127" */
"date": $formatDate($poDate)  /* "2025-11-27" */</code></pre>
                
                <h3>Extracting Dates by Qualifier</h3>
                <div class="example">
                    <strong>Extract specific dates from DTM segments:</strong>
                    <pre><code>/* QVC Pattern */
$shipDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="006"].date;
$cancelDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="069"].date;

/* Von Maur Pattern */
$shipDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="010"].date;
$cancelDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="001"].date;

/* Colony Pattern */
$deliveryDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="038"].date;
$cancelDate := message.transactionSets[0].dateTimeReference[dateTimeQualifier="371"].date;</code></pre>
                </div>
                
                <h3>NetSuite Date Field Mapping</h3>
                <table>
                    <tr>
                        <th>NetSuite Field</th>
                        <th>Description</th>
                        <th>Example Mapping</th>
                    </tr>
                    <tr>
                        <td><code>date</code></td>
                        <td>Transaction Date</td>
                        <td><code>$formatDate($beg.date)</code></td>
                    </tr>
                    <tr>
                        <td><code>requestedShipDate</code></td>
                        <td>Requested Ship Date</td>
                        <td><code>$formatDate($shipDate)</code></td>
                    </tr>
                    <tr>
                        <td><code>cancel</code></td>
                        <td>Cancel Date</td>
                        <td><code>$formatDate($cancelDate)</code></td>
                    </tr>
                    <tr>
                        <td><code>mustShipBy</code></td>
                        <td>Must Ship By Date</td>
                        <td><code>$formatDate($cancelDate)</code></td>
                    </tr>
                    <tr>
                        <td><code>custbody_deldate</code></td>
                        <td>Delivery Date (Custom)</td>
                        <td><code>$formatDate($deliveryDate)</code></td>
                    </tr>
                </table>
            </section>
            
            <!-- Pricing Section -->
            <section id="pricing">
                <h2>PRICING STRATEGIES</h2>
                
                <h3>Standard Pricing (PO1 unitPrice)</h3>
                <pre><code>"rate": $number($line.unitPrice),
"orderedUnitPrice": $number($line.unitPrice),
"priceListNumber": $number($line.unitPrice),
"price": -1,
"price_display": "Custom"</code></pre>
                
                <h3>Retail Price from CTP (HSN Pattern)</h3>
                <div class="example">
                    <strong>Use CTP if available, fallback to PO1:</strong>
                    <pre><code>$retailPrice := $po1.CTP_loop[0].pricingInformation[0].unitPrice 
  ? $po1.CTP_loop[0].pricingInformation[0].unitPrice 
  : $line.unitPrice;

"rate": $number($retailPrice),
"orderedUnitPrice": $number($retailPrice),
"priceListNumber": $number($retailPrice)</code></pre>
                </div>
                
                <div class="warning">
                    <strong>EDI PRICING:</strong> To use custom pricing from the PO instead of NetSuite's default customer price level, you must:
                    <ol>
                        <li>Enable <strong>"USE EDI PRICING"</strong> checkbox in customer/connection settings in Orderful</li>
                        <li>Set <code>"price": -1</code> and <code>"price_display": "Custom"</code></li>
                    </ol>
                    Without the checkbox, NetSuite will ignore the PO price and use the customer's default price level.
                </div>
            </section>
            
            <!-- Trading Partners Section -->
            <section id="trading-partners">
                <h2>TRADING PARTNER SPECIFIC REQUIREMENTS</h2>
                
                <!-- HSN -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">HSN</span> Home Shopping Network</h4>
                    <ul>
                        <li><strong>Custom Form:</strong> 277</li>
                        <li><strong>Ship To:</strong> Line level (extract from first PO1_loop)</li>
                        <li><strong>Item Lookup:</strong> VN (Vendor Number) → IT (Internal Number) → UPC</li>
                        <li><strong>Pricing:</strong> Use CTP retail price if available</li>
                        <li><strong>Release Number:</strong> Put in messageBlock</li>
                        <li><strong>Reference IT:</strong> Extract from REF*IT segment</li>
                    </ul>
                </div>
                
                <!-- QVC -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">QVC</span> QVC Network</h4>
                    <ul>
                        <li><strong>Custom Form:</strong> 207</li>
                        <li><strong>Date Qualifiers:</strong> 006 (requestedShipDate), 069 (mustShipBy)</li>
                        <li><strong>Item Lookup:</strong> VN → UP → SK (multi-strategy)</li>
                        <li><strong>UPC Mapping:</strong> Set <code>custcol_upccode</code> to productServiceID3</li>
                        <li><strong>EDI Pricing:</strong> Must enable "USE EDI PRICING" checkbox</li>
                        <li><strong>Buyer Fields:</strong> Map buyer.sku, buyer.buyerCatalogNumber, seller.vendorNumber</li>
                    </ul>
                </div>
                
                <!-- Von Maur -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">Von Maur</span> Von Maur Department Store</h4>
                    <ul>
                        <li><strong>Custom Form:</strong> 141</li>
                        <li><strong>Ship To:</strong> Hardcoded Distribution Center address</li>
                        <li><strong>Date Qualifiers:</strong> 010 (requestedShipDate), 001 (cancel)</li>
                        <li><strong>Item Lookup:</strong> UPC (strip leading zeros) → Vendor Style (VA)</li>
                        <li><strong>UPC Stripping:</strong> Remove leading zeros before lookup</li>
                    </ul>
                </div>
                
                <!-- Colony -->
                <div class="segment-box">
                    <h4><span class="badge badge-primary">Colony</span> Colony Brands</h4>
                    <ul>
                        <li><strong>Custom Form:</strong> 317</li>
                        <li><strong>Date Qualifiers:</strong> 038 (delivery), 371 (cancel)</li>
                        <li><strong>Custom Fields:</strong> custbody_deldate, custbody_cncldate</li>
                        <li><strong>Billing Address:</strong> Hardcoded Colony Brands AP address</li>
                        <li><strong>Price Level:</strong> Set to 1</li>
                        <li><strong>Item Lookup:</strong> VC (Vendor Catalog) → SK (SKU)</li>
                    </ul>
                </div>
            </section>
            
            <!-- Common Patterns Section -->
            <section id="patterns">
                <h2>COMPLETE MAPPING PATTERN</h2>
                
                <h3>Standard 850 Mapping Template</h3>
                <div class="example">
                    <pre><code>(
  /* =============================================================
     850 PURCHASE ORDER MAPPING - STANDARD TEMPLATE
     ============================================================= */
  
  $txnSet := message.transactionSets[0];
  $beg := $txnSet.beginningSegmentForPurchaseOrder[0];
  $poDate := $beg.date;
  $poNumber := $beg.purchaseOrderNumber;
  $releaseNumber := $beg.releaseNumber;
  
  /* Extract Ship To from header level */
  $shipTo := $txnSet.N1_loop[partyIdentification[0].entityIdentifierCode = "ST"][0];
  $shipToName := $shipTo.partyIdentification[0].name ? $trim($shipTo.partyIdentification[0].name) : "";
  $shipToAddr1 := $shipTo.partyLocation[0].addressInformation ? $trim($shipTo.partyLocation[0].addressInformation) : "";
  $shipToCity := $shipTo.geographicLocation[0].cityName ? $trim($shipTo.geographicLocation[0].cityName) : "";
  $shipToState := $shipTo.geographicLocation[0].stateOrProvinceCode ? $trim($shipTo.geographicLocation[0].stateOrProvinceCode) : "";
  $shipToZip := $shipTo.geographicLocation[0].postalCode ? $trim($shipTo.geographicLocation[0].postalCode) : "";
  
  /* Extract dates by qualifier */
  $shipDate := $txnSet.dateTimeReference[dateTimeQualifier="010"].date;
  $cancelDate := $txnSet.dateTimeReference[dateTimeQualifier="001"].date;
  
  /* Multi-strategy item lookup function */
  $findActiveItem := function($qualifier, $value) {
    $qualifier = "VN" ? $lookupItems($value, "itemid")[isinactive="F"][0] :
    $qualifier = "UP" ? $lookupItems($value, "upccode")[isinactive="F"][0] :
    $qualifier = "SK" ? $lookupItems($value, "itemid")[isinactive="F"][0] :
    undefined
  };
  
  $merge([
    $defaultValues,
    {
      "transaction": $merge([
        $defaultValues.transaction,
        {
          "date": $formatDate($poDate),
          "requestedShipDate": $shipDate ? $formatDate($shipDate) : undefined,
          "cancel": $cancelDate ? $formatDate($cancelDate) : undefined,
          "shippingAddress": {
            "attention": $shipToName,
            "addressee": $shipToName,
            "addr1": $shipToAddr1,
            "city": $shipToCity,
            "state": $shipToState,
            "zip": $shipToZip,
            "country": "US"
          },
          "messageBlock": $releaseNumber ? "Release: " & $releaseNumber : "",
          "userDefinedFields": {
            "customform": 207  /* Change per TP */
          }
        }
      ]),
      
      "transactionLines": [
        $map($txnSet.PO1_loop, function($po1) {
          (
            $line := $po1.baselineItemData[0];
            
            /* Extract identifiers */
            $vnValue := $line.productServiceIDQualifier = "VN" ? $line.productServiceID : 
                       ($line.productServiceIDQualifier1 = "VN" ? $line.productServiceID1 : "");
            $upValue := $line.productServiceID3;
            $skValue := $line.productServiceIDQualifier = "SK" ? $line.productServiceID : 
                       ($line.productServiceIDQualifier1 = "SK" ? $line.productServiceID1 : "");
            
            /* Multi-strategy item lookup */
            $nsItem := $vnValue ? $findActiveItem("VN", $vnValue) : undefined;
            $nsItem := $nsItem ? $nsItem : ($upValue ? $findActiveItem("UP", $upValue) : undefined);
            $nsItem := $nsItem ? $nsItem : ($skValue ? $findActiveItem("SK", $skValue) : undefined);
            
            /* Unwrap nested item */
            $nsItem := $nsItem.item ? $nsItem.item : $nsItem;
            $itemId := $nsItem ? $nsItem.id : null;
            $saleUnit := $nsItem ? $nsItem.saleunit : null;
            
            /* Extract description */
            $itemDescription := $po1.PID_loop[0].productItemDescription[0].description ? 
              $trim($po1.PID_loop[0].productItemDescription[0].description) : "";
            
            {
              "item": {
                "netsuiteItemId": $itemId,
                "buyer": {
                  "sku": $skValue,
                  "buyerCatalogNumber": $line.productServiceID2
                },
                "seller": {
                  "vendorNumber": $vnValue
                },
                "universal": {
                  "upc": $upValue
                }
              },
              "priceListNumber": $number($line.unitPrice),
              "originalItemData": $line,
              "nsUnitId": $saleUnit,
              "orderedQuantity": $number($line.quantityOrdered),
              "rate": $number($line.unitPrice),
              "orderedUnitPrice": $number($line.unitPrice),
              "unitLabelEDI": $line.unitOrBasisForMeasurementCode,
              "price": -1,
              "price_display": "Custom",
              "userDefinedFields": {
                "custcol_itemdescription": $itemDescription
              },
              "storeQuantities": [],
              "discount": undefined
            }
          )
        })
      ]
    }
  ])
)</code></pre>
                </div>
                
                <h3>Key Mapping Points</h3>
                <ul>
                    <li>Always use <code>$merge()</code> to combine with <code>$defaultValues</code></li>
                    <li>Extract dates using qualifiers from DTM segments</li>
                    <li>Use multi-strategy item lookup (VN → UP → SK)</li>
                    <li>Filter for active items only <code>[isinactive="F"]</code></li>
                    <li>Unwrap nested item objects</li>
                    <li>Set <code>"price": -1</code> and <code>"price_display": "Custom"</code> for EDI pricing</li>
                    <li>Map all item identifiers (buyer.sku, seller.vendorNumber, universal.upc)</li>
                    <li>Use <code>$formatDate()</code> for date conversion</li>
                    <li>Use <code>$trim()</code> for string fields</li>
                    <li>Use <code>$number()</code> for numeric fields</li>
                </ul>
            </section>
        </div>
    </div>
</body>
</html>